<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ReveilLib: rev::CascadingMotion Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ReveilLib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classrev_1_1CascadingMotion.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classrev_1_1CascadingMotion-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">rev::CascadingMotion Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="classrev_1_1Motion.html" title="Interface for generating raw motor powers.">Motion</a> class in which the outputs attempt to approach a specific velocity.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="cascading__motion_8hh_source.html">cascading_motion.hh</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for rev::CascadingMotion:</div>
<div class="dyncontent">
<div class="center"><img src="classrev_1_1CascadingMotion__inherit__graph.png" border="0" usemap="#arev_1_1CascadingMotion_inherit__map" alt="Inheritance graph"/></div>
<map name="arev_1_1CascadingMotion_inherit__map" id="arev_1_1CascadingMotion_inherit__map">
<area shape="rect" title="Motion class in which the outputs attempt to approach a specific velocity." alt="" coords="5,79,151,105"/>
<area shape="rect" href="classrev_1_1Motion.html" title="Interface for generating raw motor powers." alt="" coords="36,5,120,31"/>
<area shape="poly" title=" " alt="" coords="81,46,81,79,75,79,75,46"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for rev::CascadingMotion:</div>
<div class="dyncontent">
<div class="center"><img src="classrev_1_1CascadingMotion__coll__graph.png" border="0" usemap="#arev_1_1CascadingMotion_coll__map" alt="Collaboration graph"/></div>
<map name="arev_1_1CascadingMotion_coll__map" id="arev_1_1CascadingMotion_coll__map">
<area shape="rect" title="Motion class in which the outputs attempt to approach a specific velocity." alt="" coords="5,79,151,105"/>
<area shape="rect" href="classrev_1_1Motion.html" title="Interface for generating raw motor powers." alt="" coords="36,5,120,31"/>
<area shape="poly" title=" " alt="" coords="81,46,81,79,75,79,75,46"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a32c3ba913f3eae3c49ce5434b23f38de" id="r_a32c3ba913f3eae3c49ce5434b23f38de"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; double, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a32c3ba913f3eae3c49ce5434b23f38de">gen_powers</a> (<a class="el" href="structrev_1_1OdometryState.html">OdometryState</a> current_state, <a class="el" href="structrev_1_1Pose.html">Position</a> target_state, <a class="el" href="structrev_1_1Pose.html">Position</a> start_state, QLength drop_early) override</td></tr>
<tr class="memdesc:a32c3ba913f3eae3c49ce5434b23f38de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate motor powers.  <br /></td></tr>
<tr class="separator:a32c3ba913f3eae3c49ce5434b23f38de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40e144bf2e19b6c877a3ba61981711ed" id="r_a40e144bf2e19b6c877a3ba61981711ed"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a40e144bf2e19b6c877a3ba61981711ed">CascadingMotion</a> (double ipower, double ik_p, double ik_b, QSpeed imax_v=60 *inch/second, double ik_v=0.07)</td></tr>
<tr class="memdesc:a40e144bf2e19b6c877a3ba61981711ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new Cascading <a class="el" href="classrev_1_1Motion.html" title="Interface for generating raw motor powers.">Motion</a> controller.  <br /></td></tr>
<tr class="separator:a40e144bf2e19b6c877a3ba61981711ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classrev_1_1Motion.html" title="Interface for generating raw motor powers.">Motion</a> class in which the outputs attempt to approach a specific velocity. </p>
<p>The target velocity is determined by a formula. For pilons, this formula was</p>
<p><code>45 * (1 - exp(0.07 * error))</code>, though they used some extra stuff such as a dropEarly parameter. This formula will likely need tuning for other robots and for v5. It seems to assume a max velocity of about 45 inches per second, which is well within reason for a V4 X drive running 4" omni wheels on speed
   geared motors, as 45in/s requires ~152rpm and the speed geared V4 motors are
   capable of approximately 160rpm

   It may also be worth considering using dependency injection to allow the
   user to completely replace the velocity selection calculation, but more
   research needs to be conducted to determine if this would be necessary. Such
   a solution may have a high performance impact for a small amount of (or no)
   gain. Another good solution may be a quadratic function. Regardless of the
   choice here, DI will always be available to a programmer who wishes to
   implement their own motion controller.

   For a V5 robot running 3.25" wheels in a skid steer configuration on blue motors geared down by a ratio of 5:3, you can expect 360rpm to be the reasonable max. This leaves you with a theoretical maximum velocity of about 60 inches per second.</p>
<p>As for the other constant, 0.07, the meaning of that one is less clear. It will likely require tuning in order to make it usable. We will call this one <code>k_v</code> for reference.</p>
<p>The output power is then calculated as</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> final_power = (k_b * v_target + k_p * (v_target - v)) * sgn(power);</div>
</div><!-- fragment --><p>This may need some experimentation to determine if it is ideal. Round should not be used on v5, as the power in the context of ReveilLib is a float [-1.0, 1.0], unlike RobotC's int [-128, 127] </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a40e144bf2e19b6c877a3ba61981711ed" name="a40e144bf2e19b6c877a3ba61981711ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40e144bf2e19b6c877a3ba61981711ed">&#9670;&#160;</a></span>CascadingMotion()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rev::CascadingMotion::CascadingMotion </td>
          <td>(</td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>ipower</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>ik_p</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>ik_b</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QSpeed</td>          <td class="paramname"><span class="paramname"><em>imax_v</em></span><span class="paramdefsep"> = </span><span class="paramdefval">60&#160;*&#160;inch&#160;/&#160;second</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>ik_v</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0.07</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel explicit">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct a new Cascading <a class="el" href="classrev_1_1Motion.html" title="Interface for generating raw motor powers.">Motion</a> controller. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ipower</td><td>The power to run this motion at </td></tr>
    <tr><td class="paramname">ik_p</td><td>The proportional constant for approaching the target velocity </td></tr>
    <tr><td class="paramname">ik_b</td><td>The feed-forward constant for the target velocity </td></tr>
    <tr><td class="paramname">imax_v</td><td>The maximum target velocity of the controller </td></tr>
    <tr><td class="paramname">ik_v</td><td>The <code>k_v</code> constant for the controller </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a32c3ba913f3eae3c49ce5434b23f38de" name="a32c3ba913f3eae3c49ce5434b23f38de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32c3ba913f3eae3c49ce5434b23f38de">&#9670;&#160;</a></span>gen_powers()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; double, double &gt; rev::CascadingMotion::gen_powers </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrev_1_1OdometryState.html">OdometryState</a></td>          <td class="paramname"><span class="paramname"><em>current_state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrev_1_1Pose.html">Position</a></td>          <td class="paramname"><span class="paramname"><em>target_state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structrev_1_1Pose.html">Position</a></td>          <td class="paramname"><span class="paramname"><em>start_state</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">QLength</td>          <td class="paramname"><span class="paramname"><em>drop_early</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel override">override</span><span class="mlabel virtual">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate motor powers. </p>
<p>This is intended for use as the initial generation of motor powers. <a class="el" href="classrev_1_1Correction.html" title="Interface for correction algorithms.">Correction</a> should be applied later.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">current_state</td><td>The current state when this method is called </td></tr>
    <tr><td class="paramname">target_state</td><td>The target state being approached </td></tr>
    <tr><td class="paramname">start_state</td><td>The position occupied when the current segment gained control </td></tr>
    <tr><td class="paramname">drop_early</td><td>The distance from the target point at which this segment should end</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>std::tuple&lt;double, double&gt; </dd></dl>

<p>Implements <a class="el" href="classrev_1_1Motion.html#a22b5333ce68c7c0bb1b5facc41861580">rev::Motion</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/rev/api/alg/drive/motion/<a class="el" href="cascading__motion_8hh_source.html">cascading_motion.hh</a></li>
<li>src/api/alg/drive/motion/<b>cascading_motion.cc</b></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>rev</b></li><li class="navelem"><a class="el" href="classrev_1_1CascadingMotion.html">CascadingMotion</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
